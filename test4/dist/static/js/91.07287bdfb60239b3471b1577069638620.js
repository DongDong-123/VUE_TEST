webpackJsonp([91],{"9fwO":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("3cXf"),l=a.n(o),s=a("fYFQ"),n=a.n(s),i=(a("Kmkn"),{components:{Treeselect:n.a},created:function(){var e=this,t={pageSize:this.pageSize,pageNum:this.pageNum};t=l()(t),this.axios.post("/system/role/roleInfo",t,{headers:{"Content-Type":"application/json"}}).then(function(t){"200"==t.code&&(e.rowCount=t.data.total,e.tableBody=t.data.records)}).catch(function(e){})},computed:{radioVal:function(){return this.formItem.radio}},watch:{radioVal:function(e){this.roleSelectShow="female3"==e}},data:function(){var e=this;return{roleSelectShow:!1,menuCodes:["113002001","1268"],formItem:{levelId:"",unitIds:null},selectLength:0,roleCodeLegal:!0,roleNameLegal:!0,levelIds:[],showSelectTreeDates:!1,selectTreeDates:[],pageNum:1,rowCount:0,pageSize:10,modal2:!1,data4:[],modalDisableFlag:!0,formValidateModel1:{roleName:"",roleCode:"",roleDesc:"",notes:""},ruleValidateModel1:{roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"},{type:"string",max:64,message:"长度最大不能超过64",trigger:"blur"},{validator:function(t,a,o){if(!e.roleNameLegal)return o(new Error("角色名称已存在"));o()},trigger:"xxxx"}],notes:[{type:"string",max:100,message:"长度最大不能超过100",trigger:"blur"}],roleDesc:[{type:"string",max:100,message:"长度最大不能超过100",trigger:"blur"}],roleCode:[{required:!0,message:"请输入角色代码",trigger:"blur"},{type:"string",max:32,message:"长度最大不能超过32",trigger:"blur"},{validator:function(t,a,o){if(!e.roleCodeLegal)return o(new Error("角色代码已存在"));o()},trigger:"xxxx"}]},modal1:!1,tableHeader:[{name:"序"},{name:"操作"},{name:"角色名称"},{name:"角色代码"},{name:"角色描述"},{name:"备注"}],tableBody:[]}},methods:{getSelectLength:function(e){this.selectLength=e.length},mode1Save:function(e){var t=this,a=this;if(1!=a.modalDisableFlag){var o=!0;if(this.roleCodeLegal=!0,this.roleNameLegal=!0,this.$refs[e].validate(function(e){o=e}),!o)return;var s={roleName:this.formValidateModel1.roleName,roleCode:this.formValidateModel1.roleCode};this.axios.post("/system/role/checkRoleCodeAndName",l()(s),{headers:{"Content-Type":"application/json"}}).then(function(o){"200"==o.code&&(a.roleCodeLegal="201"!=o.data&&"203"!=o.data,a.roleNameLegal="202"!=o.data&&"203"!=o.data,t.$refs[e].validate(function(e){if(e){var o=l()(a.formValidateModel1);t.axios.post("/system/role/addRole",o,{headers:{"Content-Type":"application/json"}}).then(function(e){"200"==e.code&&(a.$Message.success("保存成功"),setTimeout(function(){a.modal1=!1,a.rowCount=a.rowCount+1,a.pageChange(Math.ceil(a.rowCount/a.pageSize))},2e3))}).catch(function(e){})}}))}).catch(function(e){})}else this.$refs[e].validate(function(e){if(e){var o=l()(a.formValidateModel1);t.axios.post("/system/role/updataRoleInfo",o,{headers:{"Content-Type":"application/json"}}).then(function(e){"200"==e.code&&(a.$Message.success("保存成功"),setTimeout(function(){a.modal1=!1},2e3))}).catch(function(e){})}})},mode2Save:function(){var e=this;if(0!=this.$refs.tree1.getCheckedNodes().length&&""!=this.formItem.levelId){var t={menu:this.data4,roleCode:this.roleCode,levelId:this.formItem.levelId,unitIds:this.formItem.unitIds};t=l()(t),this.axios.post("/system/role/setRoleAuthView",t,{headers:{"Content-Type":"application/json"}}).then(function(t){"200"==t.code&&(e.$Message.success("保存成功"),setTimeout(function(){e.modal2=!1},2e3))}).catch(function(e){})}else this.$Message.warning("操作权限和数据权限至少各选中一项")},roleSelectFun:function(e){this.roleCode=e;var t=this,a=new FormData;a.append("roleCode",e),this.axios.post("/system/role/getRoleAuthView",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){"200"==e.code&&(t.data4=e.data.menu,t.formItem=e.data.roleChecked,t.levelIds=e.data.level,t.selectTreeDates=e.data.unitTree,t.selectTreeCleanUp(t.selectTreeDates),t.levelIds.forEach(function(e){e.code==t.formItem.levelId&&(t.showSelectTreeDates=e.flag)}))}).catch(function(e){}),this.modal2=!0},updateShowSelectTreeDates:function(e){for(var t=0;t<this.levelIds.length;t++)if(this.levelIds[t].code==e)return void(this.showSelectTreeDates=this.levelIds[t].flag)},selectTreeCleanUp:function(e){for(var t=0;t<e.length;t++)e[t].children&&e[t].children.length>0?this.selectTreeCleanUp(e[t].children):this.$delete(e[t],"children")},pageChange:function(e){this.pageNum=1*e;var t=this,a={pageSize:this.pageSize,pageNum:this.pageNum};a=l()(a),this.axios.post("/system/role/roleInfo",a,{headers:{"Content-Type":"application/json"}}).then(function(e){"200"==e.code&&(t.rowCount=e.data.total,t.tableBody=e.data.records)}).catch(function(e){})},pageSizefun:function(e){this.pageSize=1*e,1==this.pageNum&&this.pageChange(1)},watchfun:function(){this.$router.push({name:"dataExtractionApplyDetail"})},addfun:function(e){this.modalDisableFlag=!1,this.formValidateModel1={roleName:"",roleCode:"",roleDesc:"",notes:""},this.$refs.formValidateModel1.resetFields(),this.modal1=!0},deleteOne:function(e){var t=this;this.$Modal.confirm({title:"是否删除？",okText:"确认",cancelText:"取消",onOk:function(){var a=l()({roleCode:e});t.axios.post("/system/role/deleteRole",a,{headers:{"Content-Type":"application/json"}}).then(function(e){if("200"==e.code){t.$Message.success("删除成功"),t.rowCount--,t.pageNum=Math.ceil(t.rowCount/t.pageSize);var a={pageSize:t.pageSize,pageNum:t.pageNum};a=l()(a),t.axios.post("/system/role/roleInfo",a,{headers:{"Content-Type":"application/json"}}).then(function(e){"200"==e.code&&(t.rowCount=e.data.total,t.tableBody=e.data.records)}).catch(function(e){})}else t.$Message.error(e.message)}).catch(function(e){})},onCancel:function(){}})},modify:function(e){var t=this;this.$refs.formValidateModel1.resetFields(),this.formValidateModel1={roleName:"",roleCode:"",roleDesc:"",notes:""};var a=l()({roleCode:e});this.axios.post("/system/role/getRoleOne",a,{headers:{"Content-Type":"application/json"}}).then(function(e){"200"==e.code&&(t.formValidateModel1=e.data,t.modalDisableFlag=!0,t.modal1=!0)}).catch(function(e){})},rolefun:function(){this.modal2=!0}}}),r={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e._m(0),e._v(" "),a("div",{staticClass:"contentCellBox"},[a("div",{staticClass:"contentCellBox"},[a("div",{staticClass:"contentCellTitle"},[a("div",{staticClass:"contentCellTitle-1"}),e._v("数据列表\n        "),a("div",{staticClass:"button-content"},[a("Button",{directives:[{name:"authcontrol",rawName:"v-authcontrol",value:{menuCode:"112003002001"},expression:"{menuCode:'112003002001'}"}],attrs:{type:"primary"},on:{click:function(t){return e.addfun(0)}}},[a("i",{staticClass:"ivu-icon ivu-icon-md-add"}),e._v("新增\n          ")])],1)]),e._v(" "),a("div",{staticClass:"contentCellBody"},[a("Row",[a("table",{staticClass:"tableBox"},[a("thead",[a("tr",e._l(e.tableHeader,function(t,o){return a("td",[e._v(e._s(t.name))])}),0)]),e._v(" "),a("tbody",[e._l(e.tableBody,function(t,o){return[a("tr",[a("td",[e._v(e._s(e.pageSize*(e.pageNum-1)+o+1))]),e._v(" "),a("td",[a("span",{staticClass:"spanBox",on:{click:function(a){return e.modify(t.roleCode)}}},[e._v("修改")]),e._v(" "),a("span",{staticClass:"spanBox",on:{click:function(a){return e.deleteOne(t.roleCode)}}},[e._v("删除")]),e._v(" "),a("span",{staticClass:"spanBox",on:{click:function(a){return e.roleSelectFun(t.roleCode)}}},[e._v("权限")]),e._v(" "),a("span",{staticClass:"spanBox"},[e._v("导出")])]),e._v(" "),a("td",[e._v(e._s(t.roleName))]),e._v(" "),a("td",[e._v(e._s(t.roleCode))]),e._v(" "),a("td",[e._v(e._s(t.roleDesc))]),e._v(" "),a("td",[e._v(e._s(t.notes))])])]})],2)])]),e._v(" "),a("div",{staticClass:"flexCenter pageBox"},[a("Page",{attrs:{total:e.rowCount,current:e.pageNum,"page-size":e.pageSize,"show-elevator":"","show-sizer":""},on:{"update:current":function(t){e.pageNum=t},"on-change":e.pageChange,"on-page-size-change":e.pageSizefun}})],1)],1)])]),e._v(" "),a("Modal",{staticClass:"dialog",attrs:{"mask-closable":!1,width:"1000",title:"角色设置"},model:{value:e.modal1,callback:function(t){e.modal1=t},expression:"modal1"}},[a("div",[a("Form",{ref:"formValidateModel1",attrs:{model:e.formValidateModel1,rules:e.ruleValidateModel1,"label-width":80}},[a("FormItem",{attrs:{label:"角色名称",prop:"roleName"}},[a("Input",{attrs:{placeholder:"请输入角色名称",disabled:e.modalDisableFlag},model:{value:e.formValidateModel1.roleName,callback:function(t){e.$set(e.formValidateModel1,"roleName",t)},expression:"formValidateModel1.roleName"}})],1),e._v(" "),a("FormItem",{attrs:{label:"角色代码",prop:"roleCode"}},[a("Input",{attrs:{placeholder:"请输入角色代码",disabled:e.modalDisableFlag},model:{value:e.formValidateModel1.roleCode,callback:function(t){e.$set(e.formValidateModel1,"roleCode",t)},expression:"formValidateModel1.roleCode"}})],1),e._v(" "),a("FormItem",{attrs:{label:"角色描述",prop:"roleDesc"}},[a("Input",{attrs:{placeholder:"请输入角色描述"},model:{value:e.formValidateModel1.roleDesc,callback:function(t){e.$set(e.formValidateModel1,"roleDesc",t)},expression:"formValidateModel1.roleDesc"}})],1),e._v(" "),a("FormItem",{attrs:{label:"备注信息",prop:"notes"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:"请输入备注信息"},model:{value:e.formValidateModel1.notes,callback:function(t){e.$set(e.formValidateModel1,"notes",t)},expression:"formValidateModel1.notes"}})],1)],1)],1),e._v(" "),a("div",{staticClass:"flexCenter",attrs:{slot:"footer"},slot:"footer"},[a("div",{staticClass:"button-content"},[e.modal1?a("Button",{attrs:{type:"primary"},on:{click:function(t){return e.mode1Save("formValidateModel1")}}},[e._v("保存")]):e._e(),e._v(" "),a("Button",{staticStyle:{"margin-left":"8px"},on:{click:function(t){e.modal1=!1}}},[e._v("取消")])],1)])]),e._v(" "),a("Modal",{staticClass:"dialog",attrs:{"mask-closable":!1,width:"1000",title:"权限"},model:{value:e.modal2,callback:function(t){e.modal2=t},expression:"modal2"}},[a("div",{staticClass:"jurisdictionModal flexStart"},[a("div",{staticClass:"jurisdictionModal-1"},[a("Tree",{ref:"tree1",attrs:{data:e.data4,"show-checkbox":"",multiple:""},on:{"on-check-change":e.getSelectLength}})],1),e._v(" "),a("div",{staticClass:"jurisdictionModal-2"},[a("div",{staticClass:"jurisdictionModal-2-1"},[e._v("数据权限")]),e._v(" "),a("div",{staticClass:"jurisdictionModal-2-2"},[a("Form",{attrs:{model:e.formItem,"label-width":80}},[a("FormItem",{attrs:{label:""}},[a("RadioGroup",{on:{"on-change":e.updateShowSelectTreeDates},model:{value:e.formItem.levelId,callback:function(t){e.$set(e.formItem,"levelId",t)},expression:"formItem.levelId"}},e._l(e.levelIds,function(t){return a("Radio",{key:t.code,attrs:{label:t.code}},[e._v(e._s(t.name))])}),1)],1),e._v(" "),a("FormItem",{attrs:{label:""}},[e.showSelectTreeDates?a("treeselect",{staticStyle:{position:"absolute",top:"15px",left:"0px"},attrs:{multiple:!0,options:e.selectTreeDates,"max-height":100},model:{value:e.formItem.unitIds,callback:function(t){e.$set(e.formItem,"unitIds",t)},expression:"formItem.unitIds"}}):e._e()],1)],1)],1)])]),e._v(" "),a("div",{staticClass:"flexCenter button-content",staticStyle:{margin:"0"},attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"primary"},on:{click:e.mode2Save}},[e._v("保存")]),e._v(" "),a("Button",{staticStyle:{"margin-left":"8px"},on:{click:function(t){e.modal2=!1}}},[e._v("取消")])],1)])],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"topTitle"},[t("span",{staticClass:"topTitle-span1"},[this._v("系统管理")]),this._v(" "),t("span",{staticClass:"topTitle-span1"},[t("img",{attrs:{src:a("Dh6M"),alt:""}})]),this._v(" "),t("span",{staticClass:"topTitle-span1"},[this._v("用户权限")]),this._v(" "),t("span",{staticClass:"topTitle-span1"},[t("img",{attrs:{src:a("Dh6M"),alt:""}})]),this._v(" "),t("span",{staticClass:"topTitle-span1"},[this._v("角色管理")])])}]};var d=a("C7Lr")(i,r,!1,function(e){a("aE2E")},"data-v-507afb64",null);t.default=d.exports},aE2E:function(e,t){}});
//# sourceMappingURL=91.07287bdfb60239b3471b1577069638620.js.map