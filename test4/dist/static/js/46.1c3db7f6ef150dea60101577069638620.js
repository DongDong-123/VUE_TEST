webpackJsonp([46],{ji5J:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("3cXf"),r=a.n(i),s=a("fYFQ"),o=a.n(s),l=(a("Kmkn"),{components:{Treeselect:o.a},created:function(){var e=this,t=this.$route.query.obj;this.formValidate.permissionTime=[this.getDateRange(new Date,0,0),this.getDateRange(new Date,-30,1)];var a="/bpm/getNodeDefDetail?bpmType=extract";if(t){for(var i=0;i<t.fileList.length;i++)e.defaultList.push({url:t.fileList[i].fileId,name:t.fileList[i].filename});a="/bpm/getNodeDefDetailByPerson?username="+t.extraApplicant+"&bpmType=extract",this.formValidate.bpmTitle=t.bpmTitle,this.formValidate.extraUnit=t.extraUnit,this.formValidate.extraTime=t.extraTime,this.formValidate.permissionTime=t.permissionTime,this.formValidate.emergeLevel=t.emergeLevel,this.formValidate.deadLine=t.deadLine,this.formValidate.notes=t.notes}this.axios.get("/extract/getExtractDic/EMERCRGENCY_LEVEL").then(function(t){"200"==t.code&&(e.emergeLevels=t.data.EMERCRGENCY_LEVEL)}).catch(function(e){}),this.axios.get(a).then(function(t){if(e.stepBox=t.data,0==t.data.length)e.$Message.warning({content:"当前你无权申请",duration:3});else{var a={bpmName:t.data[1].bpmName,nodeId:t.data[1].nodeId,roleName:t.data[1].roleName};e.formValidate.bpmName=t.data[1].bpmName,a=r()(a),e.axios.post("/bpm/getNextRole",a,{headers:{"Content-Type":"application/json"}}).then(function(t){"200"==t.code&&(e.data1=t.data,e.treeNLeafNodeDisable(e.data1))}).catch(function(e){})}}).catch(function(e){}),this.axios.post("/system/unit/getExtractUnit").then(function(t){"200"==t.code&&(e.data2=t.data,null==e.formValidate.extraUnit&&(e.formValidate.extraUnit=e.data2[0].id),e.selectTreeCleanUp(e.data2))}).catch(function(e){})},beforeUpdate:function(){this.uploadList=this.$refs.upload.fileList},data:function(){var e=this;return{options1:{disabledDate:function(e){return e&&e.valueOf()<Date.now()-864e5}},defaultList:[],modal1:!1,data2:[],data1:[],columns1:[{title:"文件名",key:"name"},{title:"操作",key:"",width:150,align:"center",render:function(t,a){return t("div",[t("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.fileDownload(a.index,a.row.name)}}},"下载"),t("Button",{props:{type:"error",size:"small"},on:{click:function(){e.remove(a.index)}}},"删除")])}}],stepBox:[],workFlowState:"01",tableHeader:{title1:"序",title2:"检查表名称",title3:"成功数据量",title4:"错误数据量",title5:"执行状态",title6:"执行开始时间",title7:"执行结束时间",title8:"操作"},tableBody:[{name:"机构对照表",success:"",error:"",startTime:"",endTime:"",flag:!1},{name:"业务类型对照表",success:"",error:"",startTime:"",endTime:"",flag:!1},{name:"存量个人客户身份信息表",success:"",error:"",startTime:"",endTime:"",flag:!1},{name:"存量单位客户身份信息表",success:"",error:"",startTime:"",endTime:"",flag:!1},{name:"受益所有人身份信息表",success:"",error:"",startTime:"",endTime:"",flag:!1},{name:"产品户信息表",success:"",error:"",startTime:"",endTime:"",flag:!1},{name:"资金账户表",success:"",error:"",startTime:"",endTime:"",flag:!1},{name:"证券账户表",success:"",error:"",startTime:"",endTime:"",flag:!1},{name:"结算资金流水表",success:"",error:"",startTime:"",endTime:"",flag:!1},{name:"单客户多银行资金调拨流水表",success:"",error:"",startTime:"",endTime:"",flag:!1},{name:"证券交割表",success:"",error:"",startTime:"",endTime:"",flag:!1},{name:"特定业务办理明细表",success:"",error:"",startTime:"",endTime:"",flag:!1},{name:"存量客户当前风险等级表",success:"",error:"",startTime:"",endTime:"",flag:!1},{name:"存量客户检查期限内历次风险等级划分表",success:"",error:"",startTime:"",endTime:"",flag:!1},{name:"大额交易报告明细表",success:"",error:"",startTime:"",endTime:"",flag:!1},{name:"可疑交易报告明细表",success:"",error:"",startTime:"",endTime:"",flag:!1}],uploadList:[],formValidate:{fileName:[],nextUserInfo:"",filePath:[],extraTime:["",""],extraUnit:null,permissionTime:["",""],emergeLevel:"",extraApplicant:"lihl",deadLine:"",notes:"",bpmTitle:""},emergeLevels:[],ruleValidate:{filePath:[{required:!0,validator:function(t,a,i){if(0==e.uploadList.length)return i(new Error("请上传附件"));i()},trigger:"change"}],bpmTitle:[{required:!0,message:"请输入流程标题",trigger:"blur"},{type:"string",max:50,message:"最大输入长度不能超过50字",trigger:"blur"}],nextUserInfo:[{required:!1,validator:function(t,a,i){if(""==e.formValidate.nextUserInfo&&e.modal1)return i(new Error("请至少选择一个审核人"));i()},trigger:"on-check-change"}],notes:[{type:"string",max:128,message:"长度最大不能超过128个字",trigger:"blur"}],extraUnit:[{required:!0,message:"请选择机构",validator:function(t,a,i){if(void 0==e.formValidate.extraUnit)return i(new Error("请选择提取机构"));i()},trigger:"xxxx"}],emergeLevel:[{required:!0,message:"请选择紧急程度",trigger:"change"}],extraTime:[{required:!0,message:"请选择时间",validator:function(t,a,i){if(""==e.formValidate.extraTime[0])return i(new Error("请选择时间"));i()},trigger:"xxxx"}],deadLine:[{required:!0,message:"请选择时间",trigger:"change"}],permissionTime:[{required:!0,validator:function(t,a,i){if(""==e.formValidate.permissionTime[0])return i(new Error("请选择时间"));i()},message:"请选择时间",trigger:"xxxx"}]}}},watch:{"formValidate.extraTime":function(e,t){this.$refs.formValidate.validateField("extraTime")},"formValidate.permissionTime":function(e,t){this.$refs.formValidate.validateField("permissionTime")},"formValidate.extraUnit":function(e,t){this.$refs.formValidate.validateField("extraUnit")}},methods:{getDateRange:function(e,t,a){var i,r=[];return i=new Date(e.getTime()-864e5*t),r.push(this.formateDate(e)),r.push(this.formateDate(i)),0==a?r[0]:r[1]},formateDate:function(e){var t=e.getFullYear(),a=e.getMonth()+1,i=e.getDate();return a<10&&(a="0"+a),i<10&&(i="0"+i),t+"-"+a+"-"+i},handleFormatError:function(e){this.$Notice.warning({title:"附件格式错误",desc:"请选择zip、rar、xls、xlsx、doc、docx、pdf."})},handleMaxSize:function(e){this.$Notice.warning({title:"超出了附件大小限制",desc:" 不应超过10M"})},updateNextUserInfo:function(e,t){var a=this;e.forEach(function(e){e.nodeKey!=t.nodeKey&&(e.checked=!1)}),this.formValidate.nextUserInfo="",e.forEach(function(e){1==e.checked&&(a.formValidate.nextUserInfo=e.code)}),this.$refs.formValidate.validateField("nextUserInfo")},treeNLeafNodeDisable:function(e){for(var t=0;t<e.length;t++)e[t].children&&(this.$set(e[t],"disabled",!0),this.$set(e[t],"expand",!0),this.treeNLeafNodeDisable(e[t].children))},selectTreeCleanUp:function(e){for(var t=0;t<e.length;t++)e[t].children&&e[t].children.length>0?this.selectTreeCleanUp(e[t].children):this.$delete(e[t],"children")},remove:function(e){var t=this,a=this.uploadList[e].url;this.axios.post("/system/remote/delFile/"+a).then(function(a){!0?(t.uploadList.splice(e,1),t.$Message.success("删除成功")):t.$Message.error("删除失败")})},handleUploadfile:function(e){var t=this.uploadList.length<5;return t||this.$Notice.warning({title:"只能上传最多五个附件."}),t},handleSuccess:function(e,t){"200"==e.code&&(t.url=e.data[0].fileId,this.$refs.formValidate.validateField("filePath"))},fileDownload:function(e,t){var a=this,i=this.uploadList[e].url,s=r()({token:"",fileId:i});this.axios.post("/system/remote/micDownLoad",s,{headers:{"Content-Type":"application/json"}}).then(function(e){var i=r()({url:e.message,fileName:t});a.axios.post("/system/remote/getFileInfo",i,{headers:{"Content-Type":"application/json"},responseType:"blob"}).then(function(e){a.download(e,t)}).catch(function(e){})}).catch(function(e){})},download:function(e,t){if(e){var a=window.URL.createObjectURL(new Blob([e])),i=document.createElement("a");i.style.display="none",i.href=a,i.setAttribute("download",t),document.body.appendChild(i),i.click()}},handleError:function(){this.$Message.error("上传失败")},stepBoxCell3:function(e){return e+1!=this.stepBox.length},next:function(e){var t=this;this.$refs[e].validate(function(e){e?t.modal1=!0:t.$Message.error("校验失败!")})},handleSubmit:function(e){var t=this,a=this;this.$refs[e].validate(function(e){if(e){a.uploadList.forEach(function(e){a.formValidate.fileName.push(e.name),a.formValidate.filePath.push(e.url)});var i=JSON.parse(r()(a.formValidate));i.fileName=r()(i.fileName),i.filePath=r()(i.filePath),i.extraTime=r()(i.extraTime),i.permissionTime=r()(i.permissionTime),i=r()(i),t.axios.post("/extract/extractApplication",i,{headers:{"Content-Type":"application/json"}}).then(function(e){if("200"==e.code){var t=e.data.basicData.batchId;e.data.basicData.id;a.$router.push({name:"dataExtractionApply2",query:{batchId:t,disabledFlag:!1,Id:"1"}})}else a.$Message.error(e.message)}).catch(function(e){})}})}}}),n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"data-extraction-apply"},[a("div",[e._m(0),e._v(" "),a("div",{staticClass:"contentCellBox"},[a("div",{staticClass:"contentCellTitle"},[a("div",{staticClass:"contentCellTitle-1"}),e._v("申请信息\n        "),a("div",{staticClass:"stepBox"},e._l(e.stepBox,function(t,i){return a("div",{key:t.nodeName,staticClass:"stepBoxCell"},[a("div",{class:t.nodeId>e.workFlowState?"stepBoxCell-1":"stepBoxCell-1-2"},[e._v(e._s(i+1))]),e._v(" "),a("div",{staticClass:"stepBoxCell-2"},[e._v(e._s(t.nodeName))]),e._v(" "),e.stepBoxCell3(i)?a("div",{staticClass:"stepBoxCell-3"}):e._e()])}),0)]),e._v(" "),a("div",{staticClass:"contentCellBody1"},[a("Form",{ref:"formValidate",attrs:{model:e.formValidate,rules:e.ruleValidate,"label-width":120,inline:""}},[a("Row",[a("FormItem",{attrs:{label:"提取数据期间：",prop:"extraTime"}},[a("DatePicker",{attrs:{"split-panels":"",type:"daterange",placeholder:"请选择时间",value:e.formValidate.extraTime},on:{"on-change":function(t){e.formValidate.extraTime=t}}})],1),e._v(" "),a("FormItem",{attrs:{label:"提交截止日期：",prop:"deadLine"}},[a("DatePicker",{attrs:{type:"date",placeholder:"请选择时间",options:e.options1,value:e.formValidate.deadLine},on:{"on-change":function(t){e.formValidate.deadLine=t}}})],1),e._v(" "),a("FormItem",{staticClass:"specical-tree",attrs:{label:"提取机构：",prop:"extraUnit"}},[a("treeselect",{staticStyle:{width:"300px"},attrs:{options:e.data2,placeholder:"请选择机构"},model:{value:e.formValidate.extraUnit,callback:function(t){e.$set(e.formValidate,"extraUnit",t)},expression:"formValidate.extraUnit"}})],1)],1),e._v(" "),a("Row",[a("FormItem",{attrs:{label:"权限使用时间：",prop:"permissionTime"}},[a("DatePicker",{attrs:{type:"daterange",placeholder:"请选择时间",options:e.options1,value:e.formValidate.permissionTime},on:{"on-change":function(t){e.formValidate.permissionTime=t}}})],1),e._v(" "),a("FormItem",{staticStyle:{width:"315px"},attrs:{label:"紧急程度：",prop:"emergeLevel"}},[a("RadioGroup",{model:{value:e.formValidate.emergeLevel,callback:function(t){e.$set(e.formValidate,"emergeLevel",t)},expression:"formValidate.emergeLevel"}},e._l(e.emergeLevels,function(t){return a("Radio",{key:t.code,attrs:{label:t.code}},[e._v(e._s(t.name))])}),1)],1),e._v(" "),a("FormItem",{attrs:{label:"流程标题：",prop:"bpmTitle"}},[a("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入流程标题"},model:{value:e.formValidate.bpmTitle,callback:function(t){e.$set(e.formValidate,"bpmTitle",t)},expression:"formValidate.bpmTitle"}})],1)],1),e._v(" "),a("Row",[a("Form-item",{staticClass:"form-item",staticStyle:{width:"100%"},attrs:{label:"附件：",prop:"filePath"}},[a("Upload",{ref:"upload",attrs:{multiple:"",type:"drag","show-upload-list":!1,"default-file-list":e.defaultList,"before-upload":e.handleUploadfile,format:["zip","rar","xls","xlsx","doc","docx","pdf"],"max-size":10240,"on-format-error":e.handleFormatError,"on-exceeded-size":e.handleMaxSize,action:e.axios.defaults.baseURL+"/system/remote/micUpload","on-success":e.handleSuccess,"on-error":e.handleError}},[a("div",{staticStyle:{padding:"20px 0"}},[a("Icon",{staticStyle:{color:"#3399ff"},attrs:{type:"ios-cloud-upload",size:"52"}}),e._v(" "),a("p",[e._v("请上传附件")])],1)]),e._v(" "),a("div",[e._v("上传格式为zip、rar、xls、doc、pdf，且大小不超过2MB")])],1),e._v(" "),a("Form-item",{staticClass:"form-item",staticStyle:{width:"100%"},attrs:{label:""}},[a("Table",{attrs:{border:"",columns:e.columns1,data:e.uploadList}})],1)],1),e._v(" "),a("Row",[a("FormItem",{staticClass:"form-item",staticStyle:{width:"100%"},attrs:{label:"备注：",prop:"notes"}},[a("Input",{staticStyle:{width:"100%"},attrs:{autosize:{minRows:2,maxRows:5},type:"textarea"},model:{value:e.formValidate.notes,callback:function(t){e.$set(e.formValidate,"notes",t)},expression:"formValidate.notes"}})],1)],1),e._v(" "),a("Row",[a("div",{staticClass:"btnClass"},[a("Button",{attrs:{type:"primary"},on:{click:function(t){return e.next("formValidate")}}},[e._v("下一步")])],1)]),e._v(" "),a("Modal",{staticClass:"treeBoxModel",attrs:{"mask-closable":!1,width:"360"},model:{value:e.modal1,callback:function(t){e.modal1=t},expression:"modal1"}},[a("p",{staticStyle:{color:"#f60","text-align":"center"},attrs:{slot:"header"},slot:"header"},[a("span",[e._v("审核人信息")])]),e._v(" "),a("div",{staticStyle:{"text-align":"left","overflow-y":"auto",height:"300px"}},[a("FormItem",{attrs:{prop:"nextUserInfo"}},[a("Tree",{ref:"treeRef",attrs:{data:e.data1,"show-checkbox":"",multiple:""},on:{"on-check-change":e.updateNextUserInfo}})],1)],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"primary",size:"large",long:""},on:{click:function(t){return e.handleSubmit("formValidate")}}},[e._v("立即申请")])],1)])],1)],1)]),e._v(" "),a("div",{staticClass:"contentCellBox"},[e._m(1),e._v(" "),a("div",{staticClass:"contentCellBody"},[a("Row",[a("table",{staticClass:"tableBox"},[a("thead",[a("tr",[a("td",[e._v(e._s(e.tableHeader.title1))]),e._v(" "),a("td",{staticClass:"textLeft"},[e._v(e._s(e.tableHeader.title2))]),e._v(" "),a("td",[e._v(e._s(e.tableHeader.title3))]),e._v(" "),a("td",[e._v(e._s(e.tableHeader.title4))]),e._v(" "),a("td",[e._v(e._s(e.tableHeader.title5))]),e._v(" "),a("td",[e._v(e._s(e.tableHeader.title6))]),e._v(" "),a("td",[e._v(e._s(e.tableHeader.title7))])])]),e._v(" "),a("tbody",e._l(e.tableBody,function(t,i){return a("tr",[a("td",[e._v(e._s(i+1))]),e._v(" "),a("td",{staticClass:"textLeft"},[e._v(e._s(t.name))]),e._v(" "),a("td",[e._v(e._s(t.success))]),e._v(" "),a("td",[e._v(e._s(t.error))]),e._v(" "),a("td",[e._v(e._s(t.status))]),e._v(" "),a("td",[e._v(e._s(t.startTime))]),e._v(" "),a("td",[e._v(e._s(t.endTime))])])}),0)])])],1)])])])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"topTitle"},[t("span",{staticClass:"topTitle-span1"},[this._v("检查数据提取")]),this._v(" "),t("span",{staticClass:"topTitle-span1"},[t("img",{attrs:{src:a("Dh6M"),alt:""}})]),this._v(" "),t("span",{staticClass:"topTitle-span1"},[this._v("提取数据申请")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"contentCellTitle"},[t("div",{staticClass:"contentCellTitle-1"}),this._v("数据列表\n      ")])}]};var d=a("C7Lr")(l,n,!1,function(e){a("q71u")},"data-v-e204a132",null);t.default=d.exports},q71u:function(e,t){}});
//# sourceMappingURL=46.1c3db7f6ef150dea60101577069638620.js.map