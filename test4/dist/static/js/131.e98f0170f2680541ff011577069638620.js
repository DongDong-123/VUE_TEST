webpackJsonp([131],{jR2j:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("3cXf"),o=a.n(i),l=a("fYFQ"),s=a.n(l),r=(a("Kmkn"),{components:{Treeselect:s.a},created:function(){var e=this,t=this,a=this.$route.query;"false"!=a.disabledFlag&&0!=a.disabledFlag||(this.disabledFlag=!0),this.axios.post("/extract/pageReviewDetail?bathcId="+a.batchId+"&Id="+a.Id).then(function(i){if("200"==i.code){var o=i.data.basicData,l=i.data.recordDatas;o.bpmTitle=o.taskName,o.fileName=[],o.filePath=[],t.formValidate=o,t.workFlowState=o.workFlowState;for(var s=0,r=0;r<l.length;r++)"执行成功"!=l[r].execuStatus&&"运行结束"!=l[r].execuStatus&&"运行失败"!=l[r].execuStatus||s++;e.num=s,t.axios.post("/bpm/getDefNodeName?bpm_name="+a.bpmName).then(function(e){t.stepBox=e.data,t.formValidate.bpmName=e.data[1].bpmName}).catch(function(e){});for(var n=0;n<t.formValidate.fileList.length;n++)t.defaultList.push({url:t.formValidate.fileList[n].fileId,name:t.formValidate.fileList[n].filename});t.formValidate.extraTime=new Array(t.formValidate.extraTime,t.formValidate.extraTime2),t.formValidate.permissionTime=new Array(t.formValidate.permissionTime,t.formValidate.permissionTime2),t.tableBody=l;for(var d=0;d<t.tableBody.length;d++)t.$set(t.tableBody[d],"flag",!1)}}),this.axios.get("/extract/getExtractDic/EMERCRGENCY_LEVEL,BUSI_SCOPE").then(function(e){"200"==e.code&&(t.emergeLevels=e.data.EMERCRGENCY_LEVEL,t.busiScopes=e.data.BUSI_SCOPE)}).catch(function(e){}),this.axios.post("/system/unit/getExtractUnit").then(function(e){"200"==e.code&&(t.selectTreeCleanUp(e.data),t.data2=e.data)}).catch(function(e){})},watch:{"$store.state.firstLoginFlag":{handler:function(e){this.firstLoginFlag=e}}},data:function(){var e=this;return{firstLoginFlag:this.$store.state.firstLoginFlag,num:0,watchAppenModel:!1,tableHeaderAppend:[{val:"序"},{val:"分片检查表名称"},{val:"检查表名称"},{val:"操作"}],tableBodyAppend:[],options1:{disabledDate:function(e){return e&&e.valueOf()<Date.now()-864e5}},defaultList:[],columns1:[{title:"文件名",key:"name"},{title:"操作",key:"",width:150,align:"center",render:function(t,a){return t("div",[t("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.fileDownload(a.index,a.row.name)}}},"下载"),t("Button",{props:{type:"error",disabled:e.disabledFlag,size:"small"},on:{click:function(){e.remove(a.index)}}},"删除")])}}],uploadList:[],disabledFlag:!1,model6:"TXT",workFlowState:"01",stepBox:[],tableHeader:{title1:"序",title2:"检查表名称",title3:"成功数据量",title4:"错误数据量",title5:"执行状态",title6:"执行开始时间",title7:"执行结束时间",title8:"操作"},tableBody:[],data2:[],formValidate:{fileName:[],filePath:[],nextUserInfo:"",extraTime:["",""],extraUnit:null,permissionTime:["",""],emergeLevel:"",extraApplicant:"lihl",deadLine:"",notes:"",bpmTitle:""},busiScopes:[],emergeLevels:[],statusList:[{code:"0",name:"等待运行"},{code:"1",name:"运行中"},{code:"2",name:"运行结束"},{code:"3",name:"运行失败"}],ruleValidate:{filePath:[{required:!0,validator:function(t,a,i){if(0==e.uploadList.length)return i(new Error("请上传附件"));i()},trigger:"change"}],bpmTitle:[{required:!0,message:"请输入主题",trigger:"blur"},{type:"string",max:50,message:"最大输入长度不能超过50字",trigger:"blur"}],nextUserInfo:[{required:!1,validator:function(t,a,i){if(""==e.formValidate.nextUserInfo&&e.modal1)return i(new Error("请至少选择一个审核人"));i()},trigger:"on-check-change"}],notes:[{type:"string",max:128,message:"长度最大不能超过128",trigger:"blur"}],extraUnit:[{required:!0,message:"请选择机构",validator:function(t,a,i){if(void 0==e.formValidate.extraUnit)return i(new Error("请选择提取机构"));i()},trigger:"xxxx"}],emergeLevel:[{required:!0,message:"请选择紧急程度",trigger:"change"}],extraTime:[{required:!0,message:"请选择时间",validator:function(t,a,i){if(""==e.formValidate.extraTime[0])return i(new Error("请选择时间"));i()},trigger:"xxxx"}],deadLine:[{required:!0,message:"请选择时间",trigger:"change"}],permissionTime:[{required:!0,validator:function(t,a,i){if(""==e.formValidate.permissionTime[0])return i(new Error("请选择时间"));i()},message:"请选择时间",trigger:"xxxx"}]}}},beforeUpdate:function(){this.uploadList=this.$refs.upload.fileList},methods:{handleFormatError:function(e){this.$Notice.warning({title:"附件格式错误",desc:"请选择zip、rar、xls、xlsx、doc、docx、pdf."})},handleMaxSize:function(e){this.$Notice.warning({title:"超出了附件大小限制",desc:" 不应超过10M"})},updateNextUserInfo:function(e,t){var a=this;e.forEach(function(e){e.nodeKey!=t.nodeKey&&(e.checked=!1)}),this.formValidate.nextUserInfo="",e.forEach(function(e){1==e.checked&&(a.formValidate.nextUserInfo=e.code)}),this.$refs.formValidate.validateField("nextUserInfo")},selectTreeCleanUp:function(e){for(var t=0;t<e.length;t++)e[t].children&&e[t].children.length>0?this.selectTreeCleanUp(e[t].children):this.$delete(e[t],"children")},handleUploadfile:function(e){var t=this.uploadList.length<5;return t||this.$Notice.warning({title:"只能上传最多五个附件."}),t},handleSuccess:function(e,t){"200"==e.code&&(t.url=e.data[0].fileId,this.$refs.formValidate.validateField("filePath"))},handleError:function(){this.$Message.error("上传失败")},singleDownload:function(e){var t=this;this.axios.post("/extract/idenDownExtractFile?tableName="+e.tableField+"&batchId="+e.batchId).then(function(a){console.log(a),"201"==a.code?(t.tableBodyAppend=a.data,t.watchAppenModel=!0):t.axios.post("/extract/downExtractFile?tableName="+e.tableField+"&batchId="+e.batchId,{},{responseType:"blob"}).then(function(a){"201"==a.code||t.download(a,e.tableName+".zip")}).catch(function(e){})}).catch(function(e){})},singleDownload2:function(e){var t=this;this.axios.post("/extract/downAllExtractFile?sourceTableName="+e.sourceTableName+"&tableName="+e.tableName+"&batchId="+e.instanceId,{},{responseType:"blob"}).then(function(a){"200"==a.code||t.download(a,e.tableName+".zip")}).catch(function(e){})},batchDownload:function(){var e=this,t=[];this.tableBody.forEach(function(e){e.flag&&t.push({id:e.id,tableName:e.tableName})}),0==t.length?this.$Message.warning("至少选择一条"):t.forEach(function(t){var a=o()({fileType:e.model6,id:t.id});e.axios.post("/extract/opt/downloadFile",a,{headers:{"Content-Type":"application/json"},responseType:"blob"}).then(function(a){e.download(a,t.tableName+".zip")}).catch(function(e){})})},stepBoxCell3:function(e){return e+1!=this.stepBox.length},handleSubmit:function(e){var t=this,a=this;this.$refs[e].validate(function(e){if(e){a.uploadList.forEach(function(e){a.formValidate.fileName.push(e.name),a.formValidate.filePath.push(e.url)});var i=JSON.parse(o()(a.formValidate));i.fileName=o()(i.fileName),i.filePath=o()(i.filePath),i.extraTime=o()(i.extraTime),i.permissionTime=o()(i.permissionTime),i=o()(i),t.axios.post("/extract/task/doRejectSubmitRetry",i,{headers:{"Content-Type":"application/json"}}).then(function(e){"200"==e.code?a.$router.push({name:"dataExtractionApplyWindow"}):a.$Message.error(e.message)}).catch(function(e){})}})},replayBatch:function(){var e,t=this;e=this.tableBody[0].batchId,this.axios.post("/extract/reDoExtractData/batchId="+e).then(function(e){t.$Message.success("已经重新执行，请稍等")}).catch(function(e){})},remove:function(e){var t=this,a=this.uploadList[e].url;this.axios.post("/system/remote/delFile/"+a).then(function(a){!0?(t.uploadList.splice(e,1),t.$Message.success("删除成功")):t.$Message.error("删除失败")})},fileDownload:function(e,t){var a=this,i=this.uploadList[e].url,l=o()({token:"",fileId:i});this.axios.post("/system/remote/micDownLoad",l,{headers:{"Content-Type":"application/json"}}).then(function(e){var i=o()({url:e.message,fileName:t});a.axios.post("/system/remote/getFileInfo",i,{headers:{"Content-Type":"application/json"},responseType:"blob"}).then(function(e){a.download(e,t)}).catch(function(e){})}).catch(function(e){})},download:function(e,t){if(e){var a=window.URL.createObjectURL(new Blob([e])),i=document.createElement("a");i.style.display="none",i.href=a,i.setAttribute("download",t),document.body.appendChild(i),i.click()}},applyBtn:function(){this.$router.push({name:"dataExtractionApply",query:{obj:this.formValidate}})},successfun:function(e,t,a){if(""==t||"运行结束"!=e.execuStatus)return!1;this.$router.push({name:"dataExtractionPreview",query:{type:"success",batchId:e.batchId,succNum:t,errorNum:a,isSuc:"0",reDoNum:e.execuApplicationNew,tableName:e.tableField}})},errorfun:function(e,t,a){if(""==t||"运行结束"!=e.execuStatus)return!1;this.$router.push({name:"dataExtractionPreview",query:{type:"error",batchId:e.batchId,succNum:t,errorNum:a,isSuc:"1",reDoNum:e.execuApplicationNew,tableName:e.tableField}})}}}),n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e._m(0),e._v(" "),a("div",{staticClass:"contentCellBox"},[a("div",{staticClass:"contentCellTitle"},[a("div",{staticClass:"contentCellTitle-1"}),e._v("\n        申请信息\n      "),a("div",{staticClass:"button-content"},[e.firstLoginFlag?a("Button",{directives:[{name:"authcontrol",rawName:"v-authcontrol",value:{menuCode:"107001007000"==this.$route.query.menuCode?"107001007010":"107003000101"},expression:"{menuCode:this.$route.query.menuCode == '107001007000'?'107001007010':'107003000101'}"}],attrs:{type:"primary"},on:{click:e.applyBtn}},[e._v("重新发起申请")]):e._e(),e._v(" "),!e.disabledFlag&&e.firstLoginFlag?a("Button",{directives:[{name:"authcontrol",rawName:"v-authcontrol",value:{menuCode:"107001007000"==this.$route.query.menuCode?"107001007020":"107003000102"},expression:"{menuCode:this.$route.query.menuCode == '107001007000'?'107001007020':'107003000102'}"}],attrs:{type:"primary"},on:{click:function(t){return e.handleSubmit("formValidate")}}},[e._v("重新提交审核")]):e._e()],1),e._v(" "),a("div",{staticClass:"stepBox"},e._l(e.stepBox,function(t,i){return a("div",{key:t.nodeName,staticClass:"stepBoxCell"},[a("div",{class:t.nodeId>e.workFlowState?"stepBoxCell-1":"stepBoxCell-1-2"},[e._v(e._s(i+1))]),e._v(" "),a("div",{staticClass:"stepBoxCell-2"},[e._v(e._s(t.nodeName))]),e._v(" "),e.stepBoxCell3(i)?a("div",{staticClass:"stepBoxCell-3"}):e._e()])}),0)]),e._v(" "),a("div",{staticClass:"contentCellBody1"},[a("Form",{ref:"formValidate",attrs:{"label-width":120,rules:e.ruleValidate,model:e.formValidate,inline:""}},[a("Row",[a("FormItem",{attrs:{label:"提取数据期间：",prop:"extraTime"}},[a("DatePicker",{attrs:{"split-panels":"",type:"daterange",placeholder:"请选择时间",readonly:e.disabledFlag,value:e.formValidate.extraTime},on:{"on-change":function(t){e.formValidate.extraTime=t}}})],1),e._v(" "),a("FormItem",{attrs:{label:"提取机构：",prop:"extraUnit"}},[a("treeselect",{staticStyle:{width:"160px"},attrs:{disabled:e.disabledFlag,options:e.data2,placeholder:"请选择机构"},model:{value:e.formValidate.extraUnit,callback:function(t){e.$set(e.formValidate,"extraUnit",t)},expression:"formValidate.extraUnit"}})],1),e._v(" "),a("FormItem",{attrs:{label:"提交截止日期：",prop:"deadLine"}},[a("DatePicker",{attrs:{type:"date",placeholder:"请选择时间",readonly:e.disabledFlag,value:e.formValidate.deadLine},on:{"on-change":function(t){e.formValidate.deadLine=t}}})],1)],1),e._v(" "),a("Row",[a("FormItem",{attrs:{label:"权限使用时间：",prop:"permissionTime"}},[a("DatePicker",{attrs:{type:"daterange",readonly:e.disabledFlag,placeholder:"请选择时间",value:e.formValidate.permissionTime},on:{"on-change":function(t){e.formValidate.permissionTime=t}}})],1),e._v(" "),a("FormItem",{attrs:{label:"紧急程度：",prop:"emergeLevel"}},[a("RadioGroup",{model:{value:e.formValidate.emergeLevel,callback:function(t){e.$set(e.formValidate,"emergeLevel",t)},expression:"formValidate.emergeLevel"}},e._l(e.emergeLevels,function(t){return a("Radio",{key:t.code,attrs:{disabled:e.disabledFlag,label:t.code}},[e._v(e._s(t.name))])}),1)],1),e._v(" "),a("FormItem",{attrs:{label:"流程标题：",prop:"bpmTitle"}},[a("Input",{staticStyle:{width:"185px"},attrs:{readonly:e.disabledFlag},model:{value:e.formValidate.bpmTitle,callback:function(t){e.$set(e.formValidate,"bpmTitle",t)},expression:"formValidate.bpmTitle"}})],1)],1),e._v(" "),a("Row",[a("Form-item",{staticClass:"form-item",staticStyle:{width:"100%"},attrs:{label:"附件：",prop:"filePath"}},[a("Upload",{ref:"upload",attrs:{multiple:"",type:"drag","show-upload-list":!1,disabled:e.disabledFlag,"default-file-list":e.defaultList,"before-upload":e.handleUploadfile,format:["zip","rar","xls","xlsx","doc","docx","pdf"],"max-size":10240,"on-format-error":e.handleFormatError,"on-exceeded-size":e.handleMaxSize,action:e.axios.defaults.baseURL+"/system/remote/micUpload","on-success":e.handleSuccess,"on-error":e.handleError}},[a("div",{staticStyle:{padding:"20px 0"}},[a("Icon",{staticStyle:{color:"#3399ff"},attrs:{type:"ios-cloud-upload",size:"52"}}),e._v(" "),a("p",[e._v("请上传附件")])],1)]),e._v(" "),a("div",[e._v("上传格式为zip、rar、xls、xlsx、doc、docx、pdf，且大小不超过10MB")])],1)],1),e._v(" "),a("Form-item",{staticClass:"form-item",staticStyle:{width:"100%"},attrs:{label:""}},[a("Table",{attrs:{border:"",columns:e.columns1,data:e.uploadList}})],1),e._v(" "),a("Row",[a("FormItem",{staticClass:"form-item",staticStyle:{width:"100%"},attrs:{label:"备注："}},[a("Input",{staticStyle:{width:"100%"},attrs:{disabled:e.disabledFlag,autosize:{minRows:2,maxRows:5},type:"textarea"},model:{value:e.formValidate.notes,callback:function(t){e.$set(e.formValidate,"notes",t)},expression:"formValidate.notes"}})],1)],1)],1)],1)]),e._v(" "),a("div",{staticClass:"contentCellBox"},[e._m(1),e._v(" "),a("div",{staticClass:"contentCellBody downBox"},[a("Row",{staticStyle:{"margin-left":"1px","margin-bottom":"20px"}},[a("ButtonGroup",["06"==e.formValidate.workFlowState&&(new Date).getTime()<new Date(e.formValidate.permissionTime2).getTime()&&this.num>=16?a("Button",{attrs:{type:"primary"},on:{click:function(t){return e.replayBatch()}}},[e._v("重新执行")]):e._e()],1)],1),e._v(" "),a("Row",[a("table",{staticClass:"tableBox"},[a("thead",[a("tr",[a("td",[e._v(e._s(e.tableHeader.title1))]),e._v(" "),a("td",{staticClass:"textLeft"},[e._v(e._s(e.tableHeader.title2))]),e._v(" "),a("td",[e._v(e._s(e.tableHeader.title3))]),e._v(" "),a("td",[e._v(e._s(e.tableHeader.title4))]),e._v(" "),a("td",[e._v(e._s(e.tableHeader.title5))]),e._v(" "),a("td",[e._v(e._s(e.tableHeader.title6))]),e._v(" "),a("td",[e._v(e._s(e.tableHeader.title7))]),e._v(" "),a("td",{staticClass:"textLeft"},[e._v(e._s(e.tableHeader.title8))])])]),e._v(" "),a("tbody",e._l(e.tableBody,function(t,i){return a("tr",{key:t.id},[a("td",[a("Checkbox",{model:{value:t.flag,callback:function(a){e.$set(t,"flag",a)},expression:"item.flag"}}),e._v("\n                "+e._s(i+1)+"\n              ")],1),e._v(" "),a("td",{staticClass:"textLeft"},[e._v(e._s(t.tableName))]),e._v(" "),a("td",{staticStyle:{color:"RGB(91,149,240)",cursor:"pointer"},on:{click:function(a){return e.successfun(t,t.succNum,t.errorNum)}}},[e._v(e._s("运行结束"==t.execuStatus?t.succNum:""))]),e._v(" "),a("td",{staticStyle:{color:"RGB(91,149,240)",cursor:"pointer"},on:{click:function(a){return e.errorfun(t,t.succNum,t.errorNum)}}},[e._v(e._s("运行结束"==t.execuStatus?t.errorNum:""))]),e._v(" "),"运行失败"==t.execuStatus?a("td",{staticStyle:{color:"RGB(250,174,98)"}},[e._v(e._s(t.execuStatus))]):e._e(),e._v(" "),"运行结束"==t.execuStatus?a("td",{staticStyle:{color:"RGB(56,218,167)"}},[e._v(e._s(t.execuStatus))]):e._e(),e._v(" "),"运行中"==t.execuStatus?a("td",{staticStyle:{color:"RGB(230,230,230)"}},[e._v(e._s(t.execuStatus))]):e._e(),e._v(" "),"等待运行"==t.execuStatus?a("td",{staticStyle:{color:"RGB(230,230,230)"}},[e._v(e._s(t.execuStatus))]):e._e(),e._v(" "),a("td",[e._v(e._s(t.execuStartTime?t.execuStartTime.substr(0,19):""))]),e._v(" "),a("td",[e._v(e._s(t.execuEndTime?t.execuEndTime.substr(0,19):""))]),e._v(" "),a("td",{staticClass:"textLeft"},["运行结束"==t.execuStatus?a("span",{staticClass:"operationSpan",on:{click:function(a){return e.singleDownload(t)}}},[e._v("下载")]):e._e()])])}),0)])])],1)]),e._v(" "),a("div",{staticStyle:{width:"100%",height:"80px"}},[e._v("如执行失败，请点击重新执行按钮，如反复失败请联系运维人员 0123-XXXXXXXX")]),e._v(" "),a("Modal",{attrs:{"mask-closable":!1,width:"99%",title:"查看"},model:{value:e.watchAppenModel,callback:function(t){e.watchAppenModel=t},expression:"watchAppenModel"}},[a("div",{staticClass:"content"},[a("Row",[a("table",{staticClass:"tableBox"},[a("thead",[a("tr",e._l(e.tableHeaderAppend,function(t,i){return a("td",[e._v(e._s(t.val))])}),0)]),e._v(" "),a("tbody",e._l(e.tableBodyAppend,function(t,i){return a("tr",[a("td",[e._v(e._s(i+1))]),e._v(" "),a("td",[e._v(e._s(t.tableName))]),e._v(" "),a("td",[e._v(e._s(t.sourceTableValue))]),e._v(" "),a("td",["运行失败"!=t.execuStatus||"运行中"!=t.execuStatus?a("span",{staticClass:"spanBox",on:{click:function(a){return e.singleDownload2(t)}}},[e._v("下载")]):e._e()])])}),0)])])],1)])],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"topTitle"},[t("span",{staticClass:"topTitle-span1"},[this._v("数据提取")]),this._v(" "),t("span",{staticClass:"topTitle-span1"},[t("img",{attrs:{src:a("Dh6M"),alt:""}})]),this._v(" "),t("span",{staticClass:"topTitle-span1"},[this._v("提取数据申请")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"contentCellTitle"},[t("div",{staticClass:"contentCellTitle-1"}),this._v("数据列表\n    ")])}]};var d=a("C7Lr")(r,n,!1,function(e){a("rXdn")},"data-v-0a52f8ea",null);t.default=d.exports},rXdn:function(e,t){}});
//# sourceMappingURL=131.e98f0170f2680541ff011577069638620.js.map