webpackJsonp([123],{NMOj:function(e,t){},lU6p:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("aA9S"),r=a.n(s),o=a("3cXf"),i=a.n(o),n=a("7BoK"),d=a("kTRA"),l=a("LQ3y"),c={components:{assessDetailPro:n.a,assessRiskProduct:d.a,adjustRiskLevelPro:l.a},created:function(){this.doTaskView()},beforeUpdate:function(){this.uploadList=this.$refs.upload.fileList},watch:{"formValidate.gender":function(e,t){"1"==this.formValidate.gender?this.showTree1Flg=!1:this.showTree1Flg=!0}},data:function(){var e=this;return{showBackFlag:!0,docId:"",tableHeader:[],tableBody:[],type:"",nextActivityName:"",nextUserName:"",nodeId:"",showTree1Flg:!0,tabname:"name1",batchId:"",uploadParams:{},showModal:!1,dataObjj:{},tabview:"",dataObj:{},defaultList:[],filesArr:[],lastStepFlag:!0,treeParam:{bpmName:"",nodeId:"",roleName:""},uploadList:[],columns1:[{title:"文件名",key:"name"},{title:"上传人",key:"creatorName"},{title:"操作",key:"",width:150,align:"center",render:function(t,a){return t("div",[t("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.fileDownload(a.index)}}},"下载"),t("Button",{props:{type:"error",disabled:parseInt(a.row.activityId)!=parseInt(JSON.parse(e.uploadParams.params).activityId),size:"small"},on:{click:function(){e.remove(a.index)}}},"删除")])}}],formValidate2:{gender:"0",treeArr1:"",desc:"",desc1:""},formValidate:{gender:"0",treeArr1:"",desc:"",desc1:""},treeArr2:[],treeArr1:[],ruleValidate:{gender:[{required:!0,message:"Please select gender",trigger:"change"}],treeArr1:[{required:!1,validator:function(t,a,s){if(console.log("this.formValidate",e.formValidate),e.lastStepFlag&&"1"!=e.formValidate.gender&&""==e.formValidate.treeArr1)return s(new Error("请至少选择一个审核人"));s()}}],desc:[{type:"string",max:512,message:"长度最大不能超过512",trigger:"blur"}]},ruleValidate2:{gender:[{required:!0,message:"Please select gender",trigger:"change"}],treeArr1:[{required:!1,validator:function(t,a,s){if(""==e.formValidate2.treeArr1)return s(new Error("请至少选择一个审核人"));s()}}],desc:[{type:"string",max:512,message:"长度最大不能超过512",trigger:"blur"}]},informationTable:{extraTime:"",extraUnit:"",busiScope:"",permissionTime:"",permissionTime1:"",emergeLevel:""},processTable:{name:"产品洗钱风险审核流程",content:[]}}},methods:{cancelModal:function(){this.showModal=!1,this.$router.push({name:"productionAssess"})},getBackButtonSts:function(){var e=this;this.axios.post("/bpm/getTaskDirective?documentId="+this.docId,{headers:{"Content-Type":"application/json"}}).then(function(t){"200"==t.code&&t.data&&"1"==t.data.optType&&(e.showBackFlag=!1)}).catch(function(e){console.log(e)})},remove:function(e){var t=this,a=this,s={deleteChild:!1,documentId:JSON.parse(this.uploadParams.params).documentId,fileId:this.uploadList[e].url,user:JSON.parse(this.uploadParams.params).user};this.axios.post("/bpm/delete",i()(s),{headers:{"Content-Type":"application/json"}}).then(function(s){(s.code="200")&&(t.uploadList.splice(e,1),a.$Message.success("删除成功"))}).catch(function(e){})},getFileList:function(e){var t=this,a=new FormData;a.append("documentId",e.documentId),this.axios.post("/bpm/list",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){"200"==e.code&&e.data.dataVo.files.forEach(function(e){t.defaultList.push({name:e.name,creatorName:e.creatorName,activityId:e.activityId,url:e.id})})}).catch(function(e){})},doTaskView:function(){var e=this,t={documentId:this.$route.query.documentId};this.getFileList(t),this.axios.post("/bpm/doTaskView",i()(t),{headers:{"Content-Type":"application/json"}}).then(function(t){if(t&&"200"==t.code){var a=JSON.parse(t.data.confirmData);e.tableHeader=a.tableHeader,e.tableBody=a.tableBody,console.log("tableData",a);var s=t.data.flowData;e.processTable.content=s.records.comments;var o=e.processTable.content[e.processTable.content.length-1];e.nextActivityName=o.nextActivityName,e.nextUserName=o.nextUserName,e.filesArr=t.data.files,e.treeParam={bpmName:s.userTask.serviceCode,nodeId:s.userTask.activityId,documentId:s.document.id,taskId:s.userTask.id,currentUser:s.userTask.ownerId,roleName:""},e.docId=s.userTask.documentId,e.getBackButtonSts(),e.uploadParams={params:{activityId:s.userTask.activityId,documentId:s.document.id,taskId:s.userTask.id,user:s.userTask.ownerId,activityName:s.userTask.name}},e.uploadParams.params=i()(e.uploadParams.params),t.data.nextNodeId==s.userTask.activityId&&(e.lastStepFlag=!1);var n=r()({},e.treeParam);n.nodeId="0"+(parseInt(n.nodeId)+1),e.getNextRole(n,"name1")}else e.$Message.error(t.message)}).catch(function(e){})},handleFormatError:function(e){this.$Notice.warning({title:"附件格式错误",desc:"请选择zip、rar、xls、xlsx、doc、docx、pdf."})},handleMaxSize:function(e){this.$Notice.warning({title:"超出了附件大小限制",desc:" 不应超过10M"})},swithTab:function(){"name2"==this.tabname&&!(this.treeArr2.length>0)&&this.getNextRole(this.treeParam,"name2")},getNextRole:function(e,t){var a=this;this.axios.post("/bpm/getNextRole",i()(e),{headers:{"Content-Type":"application/json"}}).then(function(e){"200"==e.code&&("name1"==t?(a.treeArr1=e.data,a.treeArr1.forEach(function(e){e.expand=!0}),a.treeNLeafNodeDisable(a.treeArr1)):(a.treeArr2=e.data,a.treeArr2.forEach(function(e){e.expand=!0}),a.treeNLeafNodeDisable(a.treeArr2)))}).catch(function(e){})},getTransRoleUser:function(){var e=this;this.axios.post("/system/transRoleUser?nodeId="+this.nodeId,{headers:{"Content-Type":"application/json"}}).then(function(t){"200"==t.code&&(e.treeArr2=t.data.roleUserList,e.treeArr2.forEach(function(e){e.expand=!0}),e.treeNLeafNodeDisable(e.treeArr2))}).catch(function(e){})},showDialog:function(e){var t=this;console.log("tbodys",e),e.assistFlag&&this.axios.post("/bpm/getTaskDirective?documentId="+this.docId,{headers:{"Content-Type":"application/json"}}).then(function(e){if("200"==e.code){var a=e.data;t.batchId=a.proId,e.data&&"1"==e.data.optType?a&&"pro_risk_eval"==a.stripeType?(t.modelTitle="产品洗钱风险评估",t.dataObj={id:a.proId},t.tabview="assessRiskProduct"):a&&"pro_risk_adjust"==a.stripeType&&(t.tabview="adjustRiskLevelPro",t.modelTitle="产品洗钱风险调整",t.dataObj={id:a.proId,adjStatus:"3",evalId:a.evalId,proName:a.proName,riskLevel:a.riskLevel}):e.data&&e.data.stripeType&&(t.modelTitle="产品洗钱风险详情",t.tabview="assessDetailPro",t.dataObjj={proId:a.proId,newProId:"",type:"",evalBusinessId:"",adjBusinessId:""}),t.showModal=!0}console.log("res",e)}).catch(function(e){})},fileDownload:function(e){var t=this,a=new FormData,s=this.uploadList[e].name;a.append("fileId",this.uploadList[e].url),this.axios.post("/bpm/download",a,{headers:{"Content-Type":"multipart/form-data"},responseType:"blob"}).then(function(e){t.download(e,s)}).catch(function(e){})},download:function(e,t){if(e){var a=window.URL.createObjectURL(new Blob([e])),s=document.createElement("a");s.style.display="none",s.href=a,s.setAttribute("download",t),document.body.appendChild(s),s.click()}},taskBtnFun:function(e){var t=this,a={documentId:JSON.parse(this.uploadParams.params).documentId,approveNote:this[e].desc,approveResult:this[e].gender,returnData:!0,username:"",usernames:this[e].treeArr1,id:""};a=i()(a),this.$refs[e].validate(function(s){if(s&&"0"==t[e].gender)t.axios.post("/risk/pro/eval/doProRiskEvalTaskCommit",a,{headers:{"Content-Type":"application/json"}}).then(function(e){e&&"200"==e.code?(t.$Message.info("提交成功"),t.$router.push({name:"productionAssess"})):t.$Message.info(e.message)}).catch(function(e){});else if(s&&"1"==t[e].gender){var o=r()({},t.treeParam);if(0==t[e].desc.trim().length)return t.$Message.info("请填写退回意见"),!1;o.approveNote=t[e].desc,o.approveResult=t[e].gender,t.axios.post("/risk/pro/eval/doProRiskEvalTaskCommit",i()(o),{headers:{"Content-Type":"application/json"}}).then(function(e){e&&"200"==e.code?(t.$Message.info("提交成功"),t.$router.push({name:"productionAssess"})):t.$Message.info(e.message)}).catch(function(e){})}})},doTransSubmit:function(e){var t=this;this.$refs[e].validate(function(a){if(a){var s={documentId:JSON.parse(t.uploadParams.params).documentId,approveNote:t[e].desc,approveResult:"",currentUser:t.treeParam.currentUser,returnData:!0,targetUser:t[e].treeArr1,taskId:!0};t.axios.post("/extract/task/doTransSubmit",i()(s),{headers:{"Content-Type":"application/json"}}).then(function(e){e&&"200"==e.code?(t.$Message.info("提交成功"),t.$router.push({name:"productionAssess"})):t.$Message.info("提交失败")}).catch(function(e){t.$Message.info("提交失败")})}})},treeNLeafNodeDisable:function(e){for(var t=0;t<e.length;t++)e[t].children&&(this.$set(e[t],"disabled",!0),this.treeNLeafNodeDisable(e[t].children))},updateNextUserInfo:function(e,t){var a=this;e.forEach(function(e){e.nodeKey!=t.nodeKey&&(e.checked=!1)}),this.formValidate.treeArr1="",e.forEach(function(e){1==e.checked&&(a.formValidate.treeArr1=e.code)}),this.$refs.formValidate.validateField("treeArr1")},updateNextUserInfo2:function(e,t){var a=this;e.forEach(function(e){e.nodeKey!=t.nodeKey&&(e.checked=!1)}),this.formValidate2.treeArr1="",e.forEach(function(e){1==e.checked&&(a.formValidate2.treeArr1=e.code)}),this.$refs.formValidate2.validateField("treeArr1")},handleUploadfile:function(e){var t=this,a=0;return this.uploadList.forEach(function(e){parseInt(e.activityId)==parseInt(JSON.parse(t.uploadParams.params).activityId)&&a++}),(a=a<5)||this.$Notice.warning({title:"当前节点只能上传最多五个附件."}),a},handleSuccess:function(e,t){"200"==e.code&&(t.url=e.data.dataVo.files[0].id,t.creatorName=e.data.dataVo.files[0].creatorName,t.activityId=e.data.dataVo.files[0].activityId)},handleError:function(){this.$Message.error("上传失败")}}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{position:"relative"}},[e._m(0),e._v(" "),a("div",{staticClass:"contentCellBox"},[a("div",{staticClass:"contentCellBody"},[a("div",[e._m(1),e._v(" "),a("Row",[a("table",{staticClass:"tableBox",staticStyle:{"margin-top":"0"}},[a("thead",[a("tr",e._l(e.tableHeader,function(t){return a("td",[e._v(e._s(t.name))])}),0)]),e._v(" "),a("tbody",[a("tr",e._l(e.tableBody,function(t){return a("td",{class:{"spanBox textMaxWidth textOverflow":t.assistFlag},attrs:{title:t.assistFlag?t.val:""},on:{click:function(a){return e.showDialog(t)}}},[e._v(e._s(t.val))])}),0)])])]),e._v(" "),e._m(2),e._v(" "),a("Row",[a("table",{staticClass:"tableBox",staticStyle:{"margin-top":"0"}},[a("thead",[a("tr",[a("td",[e._v("流程名称")]),e._v(" "),a("td",{attrs:{colspan:"8"}},[e._v(e._s(e.processTable.name))])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("流程步骤")]),e._v(" "),a("td",[e._v("发起时间")]),e._v(" "),a("td",[e._v("结束时间")]),e._v(" "),a("td",[e._v("办理人")]),e._v(" "),a("td",[e._v("办理人部门")]),e._v(" "),a("td",[e._v("结果")]),e._v(" "),a("td",[e._v("意见")]),e._v(" "),a("td",[e._v("下一步骤")]),e._v(" "),a("td",[e._v("下一处理人")])]),e._v(" "),e._l(e.processTable.content,function(t,s){return a("tr",{key:s},[a("td",[e._v(e._s(t.actionName))]),e._v(" "),a("td",[e._v(e._s(t.startTime))]),e._v(" "),a("td",[e._v(e._s(t.endTime))]),e._v(" "),a("td",[e._v(e._s(t.userName))]),e._v(" "),a("td",[e._v(e._s(t.userDeptName))]),e._v(" "),a("td",[e._v(e._s(0==t.approveResult||"null"==t.approveResult?"审核通过":"审核退回"))]),e._v(" "),a("td",{staticClass:"opinions",attrs:{title:"null"==t.approveNote?"通过":t.approveNote}},[e._v(e._s("null"==t.approveNote?"通过":t.approveNote))]),e._v(" "),a("td",[e._v(e._s(t.nextActivityName))]),e._v(" "),a("td",[e._v(e._s(t.nextUserName))])])})],2)])]),e._v(" "),e._m(3),e._v(" "),a("Row",[a("Upload",{ref:"upload",attrs:{multiple:"",type:"drag","show-upload-list":!1,data:e.uploadParams,"default-file-list":e.defaultList,format:["zip","rar","xls","xlsx","doc","docx","pdf"],"max-size":10240,"on-format-error":e.handleFormatError,"on-exceeded-size":e.handleMaxSize,"before-upload":e.handleUploadfile,action:e.axios.defaults.baseURL+"/bpm/upload","on-success":e.handleSuccess,"on-error":e.handleError}},[a("div",{staticStyle:{padding:"20px 0"}},[a("Icon",{staticStyle:{color:"#3399ff"},attrs:{type:"ios-cloud-upload",size:"52"}}),e._v(" "),a("p",[e._v("请上传附件")])],1)]),e._v(" "),a("div",[e._v("上传格式为zip、rar、xls、xlsx、doc、docx、pdf，且大小不超过10MB")])],1),e._v(" "),a("Table",{attrs:{border:"",columns:e.columns1,data:e.uploadList}})],1),e._v(" "),a("div",[a("Row",{staticClass:"tabBox"},[a("div",{staticClass:"taskAuditDataExtraction-right-cell"},[a("div",{staticClass:"taskAuditDataExtraction-right-cell1"},[e._v("提示：")]),e._v(" "),a("div",{staticClass:"taskAuditDataExtraction-right-cell2 flexStart"},[a("div",{staticClass:"taskAuditDataExtraction-right-cell2-cell"},[a("span",[e._v("当前处于：")]),e._v(" "),a("span",[e._v(e._s(e.nextActivityName))])]),e._v(" "),a("div",{staticClass:"taskAuditDataExtraction-right-cell2-cell"},[a("span",[e._v("当前处理人：")]),e._v(" "),a("span",[e._v(e._s(e.nextUserName))])])])]),e._v(" "),a("Row",{staticStyle:{padding:"0 5px"}},[a("Tabs",{attrs:{value:"name1",animated:!1},on:{"on-click":e.swithTab},model:{value:e.tabname,callback:function(t){e.tabname=t},expression:"tabname"}},[a("TabPane",{attrs:{label:"审核",name:"name1"}},[a("Form",{ref:"formValidate",attrs:{model:e.formValidate,rules:e.ruleValidate,"label-width":5}},[a("div",{staticClass:"taskAuditDataExtraction-right-cell1"},[e._v("意见：")]),e._v(" "),a("FormItem",{attrs:{label:"",prop:"desc"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:"请输入审核意见"},model:{value:e.formValidate.desc,callback:function(t){e.$set(e.formValidate,"desc",t)},expression:"formValidate.desc"}})],1),e._v(" "),a("div",{staticClass:"taskAuditDataExtraction-right-cell1"},[e._v("下一步操作：")]),e._v(" "),a("FormItem",{attrs:{label:"",prop:"gender"}},[a("RadioGroup",{model:{value:e.formValidate.gender,callback:function(t){e.$set(e.formValidate,"gender",t)},expression:"formValidate.gender"}},[a("Radio",{attrs:{label:"0"}},[e._v("审核通过")]),e._v(" "),a("Radio",{directives:[{name:"show",rawName:"v-show",value:e.showBackFlag,expression:"showBackFlag"}],attrs:{label:"1"}},[e._v("审核退回")])],1)],1),e._v(" "),a("FormItem",{directives:[{name:"show",rawName:"v-show",value:e.showTree1Flg&&e.lastStepFlag,expression:"showTree1Flg && lastStepFlag"}],attrs:{label:"",prop:"treeArr1"}},[a("Tree",{ref:"treeRef",attrs:{data:e.treeArr1,"show-checkbox":"",multiple:""},on:{"on-check-change":e.updateNextUserInfo}})],1),e._v(" "),a("Row",{staticClass:"flexCenter"},[a("Button",{staticStyle:{width:"100px",margin:"20px"},attrs:{type:"primary",shape:"circle"},on:{click:function(t){return e.taskBtnFun("formValidate")}}},[e._v("提交")])],1)],1)],1),e._v(" "),a("TabPane",{attrs:{label:"转办",name:"name2"}},[a("div",{staticClass:"taskAuditDataExtraction-right-cell1"},[e._v("意见：")]),e._v(" "),a("Form",{ref:"formValidate2",attrs:{model:e.formValidate2,rules:e.ruleValidate2,"label-width":5}},[a("FormItem",{attrs:{label:"",prop:"desc"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:"请输入审核意见"},model:{value:e.formValidate2.desc,callback:function(t){e.$set(e.formValidate2,"desc",t)},expression:"formValidate2.desc"}})],1),e._v(" "),a("div",{staticClass:"taskAuditDataExtraction-right-cell1"},[e._v("转办人员：")]),e._v(" "),a("FormItem",{attrs:{label:"",prop:"treeArr1"}},[a("Tree",{ref:"treeRef",attrs:{data:e.treeArr2,"show-checkbox":"",multiple:""},on:{"on-check-change":e.updateNextUserInfo2}})],1),e._v(" "),a("Row",{staticClass:"flexCenter"},[a("Button",{staticStyle:{width:"100px",margin:"20px"},attrs:{type:"primary",shape:"circle"},on:{click:function(t){return e.doTransSubmit("formValidate2")}}},[e._v("提交")])],1)],1)],1)],1)],1)],1),e._v(" "),a("div",{staticStyle:{width:"100%",height:"200px"}})],1)])]),e._v(" "),a("Modal",{staticClass:"dialog",attrs:{"mask-closable":!1,title:"任务详情",styles:{width:"80%"}},model:{value:e.showModal,callback:function(t){e.showModal=t},expression:"showModal"}},[a(e.tabview,{key:e.batchId,tag:"component",attrs:{"data-objj":e.dataObjj,dataObj:e.dataObj,width:"80%"},on:{save:e.cancelModal}}),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"})],1)],1)},staticRenderFns:[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"topTitle"},[s("span",{staticClass:"topTitle-span1"},[e._v("审核任务")]),e._v(" "),s("span",{staticClass:"topTitle-span1"},[s("img",{attrs:{src:a("Dh6M"),alt:""}})]),e._v(" "),s("span",{staticClass:"topTitle-span1"},[e._v("产品洗钱风险审核")]),e._v(" "),s("span",{staticClass:"topTitle-span1"},[s("img",{attrs:{src:a("Dh6M"),alt:""}})]),e._v(" "),s("span",{staticClass:"topTitle-span1"},[e._v("评估待审核")]),e._v(" "),s("div",{staticClass:"button-content"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"contentCellTitle"},[t("div",{staticClass:"contentCellTitle-1"}),this._v("确认信息\n        ")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"contentCellTitle"},[t("div",{staticClass:"contentCellTitle-1"}),this._v("流程信息\n        ")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"contentCellTitle"},[t("div",{staticClass:"contentCellTitle-1"}),this._v("上传附件\n        ")])}]};var u=a("C7Lr")(c,p,!1,function(e){a("NMOj")},"data-v-15963ce3",null);t.default=u.exports}});
//# sourceMappingURL=123.f9826a496a817f2e64161577069638620.js.map